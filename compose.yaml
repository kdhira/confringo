volumes:
  ca-certificates: {}
  config: {}

services:
  confringo:
    user: 0:0
    image: kevindhira/confringo:0.1.0-experimental
    volumes:
      - ca-certificates:/workspace/out/bindings/confringo-ca-certificates
      - config:/workspace/out/config
    environment:
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - LOG_LEVEL=DEBUG
      - AWS_DEFAULT_REGION=ap-southeast-2
      # - CONFRINGO_WRITE_ROOT=/workspace/out

      - CFG_JKSTEST_TYPE=jks
      - CFG_JKSTEST_DATA_GOOGLE=tlscert::google.com:443
      - CFG_JKSTEST_TARGET=/config/test.jks
      - CFG_JKSTEST_KS_PASS=password

      - CFG_SECRETSMANAGER_TYPE=file
      - CFG_SECRETSMANAGER_DATA=secretsmanager::test
      - CFG_SECRETSMANAGER_TARGET=/config/secretsmanager

      - CFG_SSM_TYPE=file
      - CFG_SSM_DATA=ssm::/confringo/test
      - CFG_SSM_TARGET=/config/ssm

      - CFG_PKCS12_DATA_CERT=base64::LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURhekNDQWxPZ0F3SUJBZ0lVUFNDMlp5SEVhbDBEcnBIVVBKcEJaYXd2RE5Fd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1JURUxNQWtHQTFVRUJoTUNRVlV4RXpBUkJnTlZCQWdNQ2xOdmJXVXRVM1JoZEdVeElUQWZCZ05WQkFvTQpHRWx1ZEdWeWJtVjBJRmRwWkdkcGRITWdVSFI1SUV4MFpEQWVGdzB5TXpBNE1Ea3dPVE0wTURsYUZ3MHlPREE0Ck1EY3dPVE0wTURsYU1FVXhDekFKQmdOVkJBWVRBa0ZWTVJNd0VRWURWUVFJREFwVGIyMWxMVk4wWVhSbE1TRXcKSHdZRFZRUUtEQmhKYm5SbGNtNWxkQ0JYYVdSbmFYUnpJRkIwZVNCTWRHUXdnZ0VpTUEwR0NTcUdTSWIzRFFFQgpBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRREo1VXJPVUhvc0pNVkYxbExvMnR3R1hzblZPYlQyU0ZTemRKRnpTeVV6CktOWUVPUkRrWnVTOGZ5OU4xNnc1MlB3aXdMWGxPcjZNZ2dPN0haL1kyb1F6aVd2L2RpSE1LeG11emc4WGoxdFQKaStmYU03QTdUeEdnbFY4Qjdjc2xuczEzK2hkZDFObktyTlR2ZllrYjE4ZWdNYWdRT2ZzRk5zbFNVRk5sRmw4dApLOEVmSk5NTC92ZldYREo3bDdtNDZUQmI2L09BK3ZyamNRWWtvM216YmU3TFY4elF5UUpVM2dLVzkvVW83N3RCCkJoc1kvVjY1TFFOamtoK0VuU3ltY0luZ0dzdVFRNGVDRTYyRXhBK0VMOCthZWljM3J2eFdQVEhMbjVtWTdBRmoKdjBSd2NSd0ljL1AvL2tMYzBxU3ZMamhCcm1tK1g2VTVwWFdiRnA0blhhMDFBZ01CQUFHalV6QlJNQjBHQTFVZApEZ1FXQkJTWWROM0MrdWdQcDdRTFVkemZ6b2Rza2J6dXBqQWZCZ05WSFNNRUdEQVdnQlNZZE4zQyt1Z1BwN1FMClVkemZ6b2Rza2J6dXBqQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQVUKUnVFK1hSV2h2SlVYVzdwRmlBSXQ3Nkh5Z2NWYXhOaEsybXdUZk1GQ0h6ME0zblJtTjJhQVVZMm13eU14dVpFNwovOXRGdnNRMWFoQ3IwbkJVcStKdExwZzRUYjFZZXJaT3FPRExtMUozWFRObkNVT1Awakoxc2p6VW1jek55ZktVClFqckRKWWt6ZmN1SVQ2amIrTzRQNUJQZGpTdk1NQW9LcWNNNjR3M0RISjY3VFVodk9aV2NsakVzczVrTlZvbkoKaWFZSHgvdHVha1I2Vkg2WnFwUnRwRGpmalVQRmRqUnZ5dmRIcjhIdFYvaUV4NXkwenZPQlBKdjhGbUVFUXVMbApVU2pQS2tqb0dUcm0yTVJKdktxZWZSdU55UmlMRlM2eFRuS245RG9Wc09YbVl2NEpEVTc4ZmJJNFB3WUZ2dlFKCld0K3VqVlNlQyt3TFpjMWtWWTlLCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
      - CFG_PKCS12_DATA_KEY=base64::LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRREo1VXJPVUhvc0pNVkYKMWxMbzJ0d0dYc25WT2JUMlNGU3pkSkZ6U3lVektOWUVPUkRrWnVTOGZ5OU4xNnc1MlB3aXdMWGxPcjZNZ2dPNwpIWi9ZMm9RemlXdi9kaUhNS3htdXpnOFhqMXRUaStmYU03QTdUeEdnbFY4Qjdjc2xuczEzK2hkZDFObktyTlR2CmZZa2IxOGVnTWFnUU9mc0ZOc2xTVUZObEZsOHRLOEVmSk5NTC92ZldYREo3bDdtNDZUQmI2L09BK3ZyamNRWWsKbzNtemJlN0xWOHpReVFKVTNnS1c5L1VvNzd0QkJoc1kvVjY1TFFOamtoK0VuU3ltY0luZ0dzdVFRNGVDRTYyRQp4QStFTDgrYWVpYzNydnhXUFRITG41bVk3QUZqdjBSd2NSd0ljL1AvL2tMYzBxU3ZMamhCcm1tK1g2VTVwWFdiCkZwNG5YYTAxQWdNQkFBRUNnZ0VBSExnZnNJSjFKcE5pZG9FNjBRSFUrNWovTi9RYUFGQ2dyOWhjbWx4dG9iM2sKMTd2d1liVWJRNDhLQVJZMVd4TTVKbzVvTVgvdVBCbUFnMXorOEgrQS83M0VIWlpGejMrd0N4UW54Ryt4aTR4aQp3a0RKQ0Y3Q2dLZk8ySHpsZ1dmNkRWK0hkR01EU2hmVXdHNklrdXZhYXppMUVmM1ZiZFB4eG1KRHdxVHdqQUdrCjYxcm4rSEkvckpsSERaS3EyYTFrZWxYc2hybzdubi9CYVp0SW82WFlZTmxMSVpibXlEaFNqYjZkdUhLR1ZCcm8KaGRHZmpCWGhCSzNZdmRNajBGTjlpZFhlOEVUVXJvVlJpYkNwWDc4cnMxeVJDK2QvNGpuZWtlb0tvcXBSc2Q3SApheUorTHJRVzNITWcxeXoycWpzRVdNZWx5T0JsRlF2b3lrZHdhUlJvY1FLQmdRRDRjMkNxMFdLMExSOWhodXVGCnY3Uk9yU0Z4RXVpNStDL2JScDJENG9SdHNjT293MHQ1NHozd3BUV1pndVhaRXA1YzEvWGdOb3Z3QnptSmxSR3UKWVd6bmdlcys4Zk0zajlIb0VXb0JuTlNXNzFEajBXRG9ENjgzTzlrWkZIUUw2VEVvN3k2bldJNlEzeDBldnZXVApOdzdwQi9xeXJ5cUVzOXd4Mi9GSEpER1FEUUtCZ1FEUUI4YjZCRjY0M2MvWldWbXZ2ZkMwN2dINE95cVBiNHgzClowQmdKUkNwaERCck5MZDZZWG5FM0c1M29RaTQvSzU5MDFrbXlEclBZWHdmSnA2OVBNRUUySW5LWDRTY3NFaC8KVzRuQVdCOFZuVXpRTjdRUE0vVDVpYTBXQlNuSWFUTnBVUU9YRTI3RklqbXQ1Nkp4enhJZ1Y1N05XMHVsVHlkagp5YTh6S1lvZnlRS0JnRjlpcElWUVdDM0dlUnJQV3RNQnM2N1ZCMWJMSkxCcFdhNDg0VEtHSDhPaGtQWFU3TUJCCi8wREpuTmR3Q3VDWkpsV00wQ2docVA0aE4vVGJWMnQwbWdRVHZBWnhpNmdVUGtsempoaEtacy8vMXpWdjZGMlAKei94THJPRFZHbXlNUGNSeWQ1M21BTzRieXFsSU5TNHM0RHVWUmFtZVdKdVVGZ0RLYVVxZjJhdHRBb0dBQTBrTQpLR2luUWs0bWVTMURFRlowbGJib2l3NE1Kd1hBOXlYSFMzMXFYUEw4Zk1UeFhOcHJQT09xVHZOWkd1cktxcXdLCnpXVCtJTVpPV29PV29EQjBiK29uaXUybFA0QTlOTjJ5T0Rwc0MwQlh0VFliL3QxNE1mU3RxaHBjeFpCN3dsOEkKS251aEZUWHNLVVh1TjlQb1dtQm4zcUJoZW5QY2tHUGdBM1BWZlprQ2dZRUF2V25mUG9iNWpqSTRKRFNGQkZrdwpiUFFGVjdqZTRxWEFweVFHNVc2OE9iSTloWGF6MnJmOFdvRjMraldneWxDQVhmMHZBMXVuRGZ4clFoR05LMjZ6CmVZeUJhb1RkUFRTL2lUZHErc251bGJLRHFWWkJsNmZqYlo5OWdqTHRMWHlmY255S3dRdkR5M29ZUC93T3ZXbzEKenFwd3lkNjN5Q2R6RDdnVzd1K0NOWWM9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
      - CFG_PKCS12_TYPE=pkcs12
      - CFG_PKCS12_TARGET=/config/test.p12
      - CFG_PKCS12_KS_PASS=password

      - CFG_FOOBAR_TYPE=ca-certificates
      - CFG_FOOBAR_DATA_0=base64::LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURhekNDQWxPZ0F3SUJBZ0lVUFNDMlp5SEVhbDBEcnBIVVBKcEJaYXd2RE5Fd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1JURUxNQWtHQTFVRUJoTUNRVlV4RXpBUkJnTlZCQWdNQ2xOdmJXVXRVM1JoZEdVeElUQWZCZ05WQkFvTQpHRWx1ZEdWeWJtVjBJRmRwWkdkcGRITWdVSFI1SUV4MFpEQWVGdzB5TXpBNE1Ea3dPVE0wTURsYUZ3MHlPREE0Ck1EY3dPVE0wTURsYU1FVXhDekFKQmdOVkJBWVRBa0ZWTVJNd0VRWURWUVFJREFwVGIyMWxMVk4wWVhSbE1TRXcKSHdZRFZRUUtEQmhKYm5SbGNtNWxkQ0JYYVdSbmFYUnpJRkIwZVNCTWRHUXdnZ0VpTUEwR0NTcUdTSWIzRFFFQgpBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRREo1VXJPVUhvc0pNVkYxbExvMnR3R1hzblZPYlQyU0ZTemRKRnpTeVV6CktOWUVPUkRrWnVTOGZ5OU4xNnc1MlB3aXdMWGxPcjZNZ2dPN0haL1kyb1F6aVd2L2RpSE1LeG11emc4WGoxdFQKaStmYU03QTdUeEdnbFY4Qjdjc2xuczEzK2hkZDFObktyTlR2ZllrYjE4ZWdNYWdRT2ZzRk5zbFNVRk5sRmw4dApLOEVmSk5NTC92ZldYREo3bDdtNDZUQmI2L09BK3ZyamNRWWtvM216YmU3TFY4elF5UUpVM2dLVzkvVW83N3RCCkJoc1kvVjY1TFFOamtoK0VuU3ltY0luZ0dzdVFRNGVDRTYyRXhBK0VMOCthZWljM3J2eFdQVEhMbjVtWTdBRmoKdjBSd2NSd0ljL1AvL2tMYzBxU3ZMamhCcm1tK1g2VTVwWFdiRnA0blhhMDFBZ01CQUFHalV6QlJNQjBHQTFVZApEZ1FXQkJTWWROM0MrdWdQcDdRTFVkemZ6b2Rza2J6dXBqQWZCZ05WSFNNRUdEQVdnQlNZZE4zQyt1Z1BwN1FMClVkemZ6b2Rza2J6dXBqQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQVUKUnVFK1hSV2h2SlVYVzdwRmlBSXQ3Nkh5Z2NWYXhOaEsybXdUZk1GQ0h6ME0zblJtTjJhQVVZMm13eU14dVpFNwovOXRGdnNRMWFoQ3IwbkJVcStKdExwZzRUYjFZZXJaT3FPRExtMUozWFRObkNVT1Awakoxc2p6VW1jek55ZktVClFqckRKWWt6ZmN1SVQ2amIrTzRQNUJQZGpTdk1NQW9LcWNNNjR3M0RISjY3VFVodk9aV2NsakVzczVrTlZvbkoKaWFZSHgvdHVha1I2Vkg2WnFwUnRwRGpmalVQRmRqUnZ5dmRIcjhIdFYvaUV4NXkwenZPQlBKdjhGbUVFUXVMbApVU2pQS2tqb0dUcm0yTVJKdktxZWZSdU55UmlMRlM2eFRuS245RG9Wc09YbVl2NEpEVTc4ZmJJNFB3WUZ2dlFKCld0K3VqVlNlQyt3TFpjMWtWWTlLCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
      - CFG_FOOBAR_DATA_1=tlscert::google.com:443

  tester:
    image: bash
    command: ["ls", "-Rl", "/config", "/bindings"]
    depends_on:
      confringo:
        condition: service_completed_successfully
    volumes:
      - config:/config
      - ca-certificates:/bindings/confringo-ca-certificates
